# 谁是卧底游戏测试计划

## 1. 测试环境准备

### 1.1 环境配置
- Docker 和 Docker Compose 已安装
- 微信公众号测试账号（或开发环境模拟）
- Redis 数据库
- Flask 应用服务

### 1.2 测试工具
- Postman 或类似的 API 测试工具
- 微信开发者工具
- 单元测试框架 (pytest)

## 2. 功能测试用例

### 2.1 房间管理测试

#### TC001: 创建房间
**前置条件**: 用户已关注公众号
**测试步骤**:
1. 用户发送"创建房间"消息
**预期结果**:
- 返回成功创建房间的信息
- 包含房间号
- 用户成为房主
- 房间状态为等待中

#### TC002: 重复创建房间
**前置条件**: 用户已创建一个房间
**测试步骤**:
1. 用户再次发送"创建房间"消息
**预期结果**:
- 提示用户已在房间中
- 不创建新房间

#### TC003: 加入房间
**前置条件**: 已存在一个等待中的房间
**测试步骤**:
1. 新用户发送"加入房间+房间号"消息
**预期结果**:
- 成功加入房间
- 房间人数增加
- 所有房间内用户收到新玩家加入通知

#### TC004: 加入不存在的房间
**前置条件**: 无
**测试步骤**:
1. 用户发送"加入房间1234"（假设1234房间不存在）
**预期结果**:
- 返回房间不存在提示

#### TC005: 加入已开始的房间
**前置条件**: 房间已开始游戏
**测试步骤**:
1. 用户发送"加入房间+房间号"
**预期结果**:
- 返回游戏已开始无法加入提示

### 2.2 游戏开始测试

#### TC006: 房主开始游戏(人数不足)
**前置条件**: 房间内只有2名玩家
**测试步骤**:
1. 房主发送"开始游戏"消息
**预期结果**:
- 返回人数不足提示（至少3人）

#### TC007: 非房主尝试开始游戏
**前置条件**: 房间内有3名以上玩家，当前用户不是房主
**测试步骤**:
1. 非房主用户发送"开始游戏"消息
**预期结果**:
- 返回只有房主才能开始游戏提示

#### TC008: 房主开始游戏(满足条件)
**前置条件**: 房间内有3名以上玩家，当前用户是房主
**测试步骤**:
1. 房主发送"开始游戏"消息
**预期结果**:
- 房间状态变为"游戏中"
- 根据人数正确分配卧底数量
- 所有玩家收到词语和身份信息

### 2.3 游戏进行测试

#### TC009: 查看状态
**前置条件**: 用户在房间中
**测试步骤**:
1. 用户发送"查看状态"消息
**预期结果**:
- 显示用户序号和昵称
- 显示房间信息和成员列表
- 显示游戏状态和轮次信息

#### TC010: 房主投票(正确序号)
**前置条件**: 游戏正在进行中，当前用户是房主
**测试步骤**:
1. 房主发送"t1"消息（假设要投票给1号玩家）
**预期结果**:
- 1号玩家被标记为已淘汰
- 所有玩家收到投票结果通知

#### TC011: 房主投票(错误序号)
**前置条件**: 游戏正在进行中，当前用户是房主
**测试步骤**:
1. 房主发送"t99"消息（假设房间只有5人）
**预期结果**:
- 返回序号无效提示

#### TC012: 非房主尝试投票
**前置条件**: 游戏正在进行中，当前用户不是房主
**测试步骤**:
1. 用户发送"t1"消息
**预期结果**:
- 返回只有房主才能投票提示

#### TC013: 投票给已淘汰玩家
**前置条件**: 游戏正在进行中，1号玩家已被淘汰
**测试步骤**:
1. 房主发送"t1"消息
**预期结果**:
- 返回该玩家已被淘汰提示

### 2.4 游戏结束测试

#### TC014: 平民获胜
**前置条件**: 游戏进行中，所有卧底都被淘汰
**测试步骤**:
1. 房主投票淘汰最后一个卧底
**预期结果**:
- 房间状态变为"已结束"
- 所有玩家收到平民获胜通知

#### TC015: 卧底获胜
**前置条件**: 游戏进行中，剩余玩家中卧底数量≥平民数量
**测试步骤**:
1. 房主投票淘汰一名平民
**预期结果**:
- 房间状态变为"已结束"
- 所有玩家收到卧底获胜通知

### 2.5 辅助功能测试

#### TC016: 查看游戏玩法
**前置条件**: 无
**测试步骤**:
1. 用户发送"谁是卧底"消息
**预期结果**:
- 返回详细的游戏玩法说明

#### TC017: 查看帮助
**前置条件**: 无
**测试步骤**:
1. 用户发送"帮助"消息
**预期结果**:
- 返回所有可用命令列表

#### TC018: 未知命令
**前置条件**: 无
**测试步骤**:
1. 用户发送任意未知命令
**预期结果**:
- 返回未知命令提示


## 3. 微信接口测试

### 3.1 消息接收测试

#### TC019: 文本消息处理
**前置条件**: 服务正常运行
**测试步骤**:
1. 发送各种文本命令到服务器
**预期结果**:
- 正确解析并处理各类命令

#### TC020: 关注事件处理
**前置条件**: 服务正常运行
**测试步骤**:
1. 模拟用户关注公众号事件
**预期结果**:
- 返回欢迎消息和操作指引

#### TC021: 菜单点击事件处理
**前置条件**: 服务正常运行，自定义菜单已配置
**测试步骤**:
1. 点击"谁是卧底"菜单项
**预期结果**:
- 返回游戏玩法说明

## 4. 异常处理测试

### 4.1 网络异常测试

#### TC022: Redis连接失败
**前置条件**: Redis服务不可用
**测试步骤**:
1. 执行任何需要Redis的操作
**预期结果**:
- 系统记录错误日志
- 返回友好的错误提示

#### TC023: 微信服务器响应超时
**前置条件**: 网络不稳定
**测试步骤**:
1. 模拟微信服务器响应超时
**预期结果**:
- 系统记录错误日志
- 返回success给微信服务器

### 4.2 数据异常测试

#### TC024: Redis数据损坏
**前置条件**: Redis中存储的数据格式错误
**测试步骤**:
1. 执行读取房间信息的操作
**预期结果**:
- 系统能够处理异常数据
- 返回合理的默认值或错误提示

## 5. 性能测试

### 5.1 并发测试

#### TC025: 多房间并发
**前置条件**: 系统正常运行
**测试步骤**:
1. 同时创建和操作多个房间
**预期结果**:
- 系统能够正确处理所有房间
- 响应时间在可接受范围内

#### TC026: 大量用户测试
**前置条件**: 系统正常运行
**测试步骤**:
1. 单个房间内加入12名玩家
**预期结果**:
- 系统正确分配3个卧底
- 所有功能正常运行

## 6. 安全测试

### 6.1 输入验证测试

#### TC027: SQL注入测试
**前置条件**: 系统正常运行
**测试步骤**:
1. 发送包含SQL注入代码的命令
**预期结果**:
- 系统正确过滤恶意输入
- 不执行恶意代码

#### TC028: XSS攻击测试
**前置条件**: 系统正常运行
**测试步骤**:
1. 发送包含XSS攻击代码的命令
**预期结果**:
- 系统正确过滤恶意输入
- 不执行恶意脚本

## 7. 回归测试

在每次代码更新后，需要执行以下核心测试用例：
- TC001: 创建房间
- TC003: 加入房间
- TC008: 房主开始游戏(满足条件)
- TC009: 查看状态
- TC010: 房主投票(正确序号)
- TC014: 平民获胜 或 TC015: 卧底获胜

## 8. 测试执行计划

### 第一阶段：单元测试
- 执行所有功能测试用例
- 验证核心业务逻辑

### 第二阶段：集成测试
- 测试微信接口集成
- 验证Docker Compose部署

### 第三阶段：性能测试
- 执行并发和负载测试
- 验证系统稳定性

### 第四阶段：验收测试
- 邀请真实用户进行测试
- 收集反馈并优化